in_crowdstrike_alerts_v2:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule:
    cronSchedule: "*/5 * * * *"
    maxConcurrentRuns: 1
    skippable: true
    run:
      rescheduleDroppedTasks: true
      maxTaskReschedule: 1
      logLevel: info
      jobTimeout: 60m
      mode: run
      timeRangeType: relative
      timeWarning: {}
      expression: "true"
      minTaskSize: 1MB
      maxTaskSize: 10MB
      stateTracking:
        stateUpdateExpression: "__timestampExtracted !== false && {latestTime:
          (state.latestTime || 0) > _time ? state.latestTime : _time}"
        stateMergeExpression: "(prevState.latestTime || 0) > newState.latestTime ?
          prevState : newState"
        enabled: true
    enabled: false
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: http
        discoverMethod: get
        pagination:
          type: response_body
          maxPages: 50
          attribute:
            - offset
          lastPageExpr: offset==""
        enableStrictDiscoverParsing: false
        enableDiscoverCode: false
        discoverUrl: "'https://api.us-2.crowdstrike.com/alerts/queries/alerts/v2'"
        discoverRequestParams:
          - name: limit
            value: "1000"
          - name: filter
            value: "`updated_timestamp:>='${new Date(earliest*1000*300 ||
              Date.now()-(60*60*1000*24*30)).toISOString()}'`"
        discoverRequestHeaders:
          - name: Accept
            value: "application/json"
          - name: Content-Type
            value: "application/json"
          - name: User-Agent
            value: "Cribl"
      collectMethod: post_with_body
      pagination:
        type: response_body
        maxPages: 0
        offsetField: offset
        limitField: limit
        limit: 50
        zeroIndexed: false
        attribute:
          - offset
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: true
      decodeUrl: true
      rejectUnauthorized: false
      captureHeaders: false
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "'https://api.us-2.crowdstrike.com/oauth2/token'"
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: client_secret
      loginBody: "`client_id=${username}&client_secret=${password}`"
      tokenRespAttribute: access_token
      collectUrl: "'https://api.us-2.crowdstrike.com/alerts/entities/alerts/v2'"
      credentialsSecret: CrowdstrikeAPI
      authRequestHeaders:
        - name: Content-Type
          value: "application/json"
        - name: accept
          value: "application/json"
        - name: User-agent
          value: "Cribl"
      collectBody: '`{"composite_ids":${JSON.stringify(resources)}}`'
      collectRequestHeaders:
        - name: Content-Type
          value: "application/json"
        - name: accept
          value: "application/json"
      authRequestParams:
        - name: client_id
          value: "'YOUR_CLIENT_ID'"
      clientSecretParamValue: "'YOUR_CLIENT_SECRET'"
    destructive: false
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    metadata:
      - name: __packsource
        value: "'cribl-crowdstrike-rest-io.crowdstrike-alerts-v2-api'"
    breakerRulesets:
      - Crowdstrike API Ruleset
  savedState: {}
  notifications: []
in_crowdstrike_vulnerabilities:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule:
    cronSchedule: "*/30 * * * *"
    maxConcurrentRuns: 1
    skippable: true
    run:
      rescheduleDroppedTasks: true
      maxTaskReschedule: 1
      logLevel: info
      jobTimeout: 60m
      mode: run
      timeRangeType: relative
      timeWarning: {}
      expression: "true"
      minTaskSize: 1MB
      maxTaskSize: 10MB
      stateTracking:
        stateUpdateExpression: "__timestampExtracted !== false && {latestTime:
          (state.latestTime || 0) > _time ? state.latestTime : _time}"
        stateMergeExpression: "(prevState.latestTime || 0) > newState.latestTime ?
          prevState : newState"
        enabled: true
    enabled: false
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: none
      collectMethod: get
      pagination:
        type: response_body
        maxPages: 50
        attribute:
          - after
        lastPageExpr: after==""
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: false
      decodeUrl: false
      rejectUnauthorized: false
      captureHeaders: true
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "'https://api.us-2.crowdstrike.com/oauth2/token'"
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: client_secret
      collectUrl: "'https://api.us-2.crowdstrike.com/spotlight/combined/vulnerabiliti\
        es/v1'"
      collectRequestParams:
        - name: filter
          value: "`updated_timestamp:>'${earliest ?
            C.Time.strftime(earliest,'%Y-%m-%dT%H:%M') :
            C.Time.strftime(Date.now()/1000 -
            86400,'%Y-%m-%dT%H:%M')}'+updated_timestamp:<'${latest ?
            C.Time.strftime(latest,'%Y-%m-%dT%H:%M') :
            C.Time.strftime(Date.now()/1000,'%Y-%m-%dT%H:%M')}'+status:'open'`"
        - name: limit
          value: "500"
        - name: after
          value: "`${after}`"
        - name: facet
          value: '"cve"'
        - name: facet
          value: '"host_info"'
        - name: facet
          value: '"remediation"'
        - name: facet
          value: '"evaluation_logic"'
      collectRequestHeaders:
        - name: Content-Type
          value: "application/json"
        - name: accept
          value: "application/json"
      clientSecretParamValue: "'YOUR_CLIENT_SECRET'"
      authRequestParams:
        - name: client_id
          value: "'YOUR_CLIENT_ID'"
      tokenRespAttribute: access_token
      authRequestHeaders:
        - value: "application/json"
          name: Content-Type
        - name: accept
          value: "application/json"
        - name: user_agent
          value: "Cribl"
    destructive: false
    encoding: utf8
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    breakerRulesets:
      - Crowdstrike API Ruleset
    metadata:
      - name: __packsource
        value: "'cribl-crowdstrike-rest-io.crowdstrike-vulnerabilities-api'"
  savedState: {}
  description: "Pulling Data from the Crowdstrike Vulnerability API.  You can
    query using updated_timestamp (default) or created_timestamp; your choice. "
  notifications: []
in_crowdstrike_alerts:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule:
    cronSchedule: "*/5 * * * *"
    maxConcurrentRuns: 1
    skippable: true
    run:
      rescheduleDroppedTasks: true
      maxTaskReschedule: 1
      logLevel: info
      jobTimeout: 60m
      mode: run
      timeRangeType: relative
      timeWarning: {}
      expression: "true"
      minTaskSize: 1MB
      maxTaskSize: 10MB
      stateTracking:
        stateUpdateExpression: "__timestampExtracted !== false && {latestTime:
          (state.latestTime || 0) > _time ? state.latestTime : _time}"
        stateMergeExpression: "(prevState.latestTime || 0) > newState.latestTime ?
          prevState : newState"
        enabled: true
    enabled: false
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: http
        discoverMethod: get
        pagination:
          type: none
        enableStrictDiscoverParsing: false
        enableDiscoverCode: false
        discoverUrl: "'https://api.us-2.crowdstrike.com/alerts/queries/alerts/v1'"
        discoverRequestParams:
          - name: limit
            value: "9999"
          - name: filter
            value: "`updated_timestamp:>'${new Date(earliest*1000*300 ||
              Date.now()-(60*60*1000*24*1)).toISOString()}'`"
        discoverRequestHeaders:
          - name: Accept
            value: "application/json"
          - name: Content-Type
            value: "application/json"
          - name: User-Agent
            value: "Cribl"
      collectMethod: post_with_body
      pagination:
        type: none
        offsetField: offset
        limitField: limit
        limit: 50
        maxPages: 50
        zeroIndexed: false
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: true
      decodeUrl: true
      rejectUnauthorized: false
      captureHeaders: false
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "'https://api.us-2.crowdstrike.com/oauth2/token'"
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: client_secret
      loginBody: "`client_id=${username}&client_secret=${password}`"
      tokenRespAttribute: access_token
      collectUrl: "'https://api.us-2.crowdstrike.com/alerts/entities/alerts/v1'"
      credentialsSecret: CrowdstrikeAPI
      authRequestHeaders:
        - name: Content-Type
          value: "application/json"
        - name: accept
          value: "application/json"
        - name: User-agent
          value: "Cribl"
      collectBody: '`{"ids":${JSON.stringify(resources)}}`'
      collectRequestHeaders: []
      authRequestParams:
        - name: client_id
          value: "'YOUR_CLIENT_ID'"
      clientSecretParamValue: "'YOUR_CLIENT_SECRET'"
    destructive: false
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    metadata:
      - name: __packsource
        value: "'cribl-crowdstrike-rest-io.crowdstrike-alerts-api'"
    breakerRulesets:
      - Crowdstrike API Ruleset
  savedState: {}
  notifications: []
in_crowdstrike_devices:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule:
    cronSchedule: 3 */8 * * *
    maxConcurrentRuns: 1
    skippable: true
    run:
      rescheduleDroppedTasks: true
      maxTaskReschedule: 1
      logLevel: info
      jobTimeout: 60m
      mode: run
      timeRangeType: relative
      timeWarning: {}
      expression: "true"
      minTaskSize: 1MB
      maxTaskSize: 10MB
      stateTracking:
        stateUpdateExpression: "__timestampExtracted !== false && {latestTime:
          (state.latestTime || 0) > _time ? state.latestTime : _time}"
        stateMergeExpression: "(prevState.latestTime || 0) > newState.latestTime ?
          prevState : newState"
        enabled: false
    enabled: false
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: http
        discoverMethod: get
        pagination:
          type: response_body
          maxPages: 500
          attribute:
            - offset
          lastPageExpr: offset==""
        enableStrictDiscoverParsing: false
        enableDiscoverCode: false
        discoverUrl: "'https://api.us-2.crowdstrike.com/devices/queries/devices-scroll/v1'"
        discoverRequestParams:
          - name: limit
            value: "2"
          - name: offset
            value: "`${offset}`"
        discoverRequestHeaders:
          - name: accept
            value: "application/json"
        discoverDataField: resources
      collectMethod: get
      pagination:
        type: response_body
        maxPages: 500
        attribute:
          - offset
        lastPageExpr: offset==""
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: false
      decodeUrl: false
      rejectUnauthorized: false
      captureHeaders: true
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "'https://api.us-2.crowdstrike.com/oauth2/token'"
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: client_secret
      collectUrl: "'https://api.us-2.crowdstrike.com/devices/entities/devices/v2'"
      collectRequestParams:
        - name: limit
          value: "500"
        - name: offset
          value: "`${offset}`"
        - name: ids
          value: "`${id}`"
      collectRequestHeaders:
        - name: accept
          value: "application/json"
      clientSecretParamValue: "'YOUR_CLIENT_SECRET'"
      authRequestParams:
        - name: client_id
          value: "'YOUR_CLIENT_ID'"
      tokenRespAttribute: access_token
      authRequestHeaders:
        - value: "application/json"
          name: Content-Type
        - name: accept
          value: "application/json"
    destructive: false
    encoding: utf8
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    breakerRulesets:
      - Crowdstrike API Ruleset
    metadata:
      - name: __packsource
        value: "'cribl-crowdstrike-rest-io.crowdstrike-devices-api'"
  savedState: {}
  notifications: []
